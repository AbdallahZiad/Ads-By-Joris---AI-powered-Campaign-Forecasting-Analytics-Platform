services:
  # --- Backend API (Hot Reload) ---
  backend:
    volumes:
      - ./backend:/app
    command: bash /app/scripts/start-reload.sh

  # --- Frontend (Hot Reload) ---
  frontend:
    build:
      context: ./frontend
      target: base  # <--- CRITICAL FIX: Stops build at Node stage, ignoring Nginx
    volumes:
      - ./frontend:/app
      - /app/node_modules
    command: npm run dev -- --host

  # --- CPU Worker (Live Code) ---
  worker_cpu:
    volumes:
      - ./backend:/app

  # --- I/O Worker (Live Code) ---
  worker_io:
    volumes:
      - ./backend:/app