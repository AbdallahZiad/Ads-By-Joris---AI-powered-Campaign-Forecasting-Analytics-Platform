services:
  # --- Backend API (Hot Reload) ---
  backend:
    volumes:
      - ./backend:/app
    command: bash /app/scripts/start-reload.sh

  # --- Frontend (Hot Reload) ---
  frontend:
    volumes:
      # 1. Mount source code for live updates
      - ./frontend:/app

      # 2. ANONYMOUS VOLUME TRICK (CRITICAL)
      # Prevents host node_modules from overwriting container node_modules
      - /app/node_modules

    # Enable polling for hot reload (sometimes needed on Windows/WSL)
    # We pass --host to bind to 0.0.0.0
    command: npm run dev -- --host

  # --- CPU Worker (Live Code) ---
  worker_cpu:
    volumes:
      - ./backend:/app

  # --- I/O Worker (Live Code) ---
  worker_io:
    volumes:
      - ./backend:/app